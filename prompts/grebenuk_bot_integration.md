# Инструкции по интеграции промптов в бота Михаила Гребенюка

## Обзор

Данный документ содержит инструкции по интеграции промптов в бота Михаила Гребенюка. Промпты используются для анализа ответов на возражения, генерации возражений и анализа ошибок в запросах пользователей.

## Структура промптов

Все промпты разделены на несколько категорий:

1. Базовый промпт для анализа ответа на возражение
2. Промпт для режима "Цена"
3. Промпт для режима "Доверие"
4. Промпт для режима "Срочность"
5. Промпт для режима генерации возражений
6. Промпт для режима анализа ошибок в запросе

## Интеграция в сервис бота

Для интеграции промптов в сервис бота, необходимо модифицировать метод `analyzeResponse` в файле `src/grebenuk-bot/grebenuk-bot.service.ts`:

```typescript
/**
 * Анализировать ответ пользователя с помощью GPT-4
 */
async analyzeResponse(
  objection: string,
  userResponse: string,
  category?: string
): Promise<{
  score: number;
  feedback: string;
  hasRecognition: boolean;
  hasArgument: boolean;
  hasReversal: boolean;
  hasCallToAction: boolean;
  idealResponse: string;
  errors?: string[];
}> {
  try {
    // Выбираем промпт в зависимости от категории возражения
    let prompt = '';

    if (category === 'Цена') {
      prompt = `
      Ты - Михаил Гребенюк, известный бизнес-тренер и эксперт по продажам с жестким, прямолинейным стилем общения.

      Проанализируй ответ на возражение клиента по ЦЕНЕ и оцени его по шкале от 1 до 10.

      Возражение клиента: "${objection}"

      Ответ продавца: "${userResponse}"

      При анализе ответа на возражение по цене, обрати особое внимание на:
      1. Признание ценности продукта/услуги
      2. Объяснение, почему цена соответствует ценности
      3. Сравнение с конкурентами (если уместно)
      4. Предложение вариантов оплаты или скидок (если уместно)

      Оцени ответ по следующим критериям:
      1. Признание возражения (да/нет)
      2. Аргументация (да/нет)
      3. Переворот возражения (да/нет)
      4. Призыв к действию (да/нет)

      Дай общую оценку от 1 до 10.

      Напиши идеальный ответ на это возражение в твоем стиле.

      Дай обратную связь в своем фирменном стиле - если ответ плохой, иронично давишь и шутишь, если хороший - хвалишь, но предлагаешь улучшение.

      Ответ должен быть в формате JSON:
      {
        "score": число от 1 до 10,
        "hasRecognition": true/false,
        "hasArgument": true/false,
        "hasReversal": true/false,
        "hasCallToAction": true/false,
        "idealResponse": "текст идеального ответа",
        "feedback": "твоя обратная связь в твоем стиле",
        "errors": ["список ошибок в ответе по работе с возражением по цене"]
      }
      `;
    } else if (category === 'Доверие') {
      prompt = `
      Ты - Михаил Гребенюк, известный бизнес-тренер и эксперт по продажам с жестким, прямолинейным стилем общения.

      Проанализируй ответ на возражение клиента по ДОВЕРИЮ и оцени его по шкале от 1 до 10.

      Возражение клиента: "${objection}"

      Ответ продавца: "${userResponse}"

      При анализе ответа на возражение по доверию, обрати особое внимание на:
      1. Использование социальных доказательств (отзывы, кейсы, примеры)
      2. Демонстрацию экспертности и опыта
      3. Предоставление гарантий
      4. Прозрачность и честность в коммуникации

      Оцени ответ по следующим критериям:
      1. Признание возражения (да/нет)
      2. Аргументация (да/нет)
      3. Переворот возражения (да/нет)
      4. Призыв к действию (да/нет)

      Дай общую оценку от 1 до 10.

      Напиши идеальный ответ на это возражение в твоем стиле.

      Дай обратную связь в своем фирменном стиле - если ответ плохой, иронично давишь и шутишь, если хороший - хвалишь, но предлагаешь улучшение.

      Ответ должен быть в формате JSON:
      {
        "score": число от 1 до 10,
        "hasRecognition": true/false,
        "hasArgument": true/false,
        "hasReversal": true/false,
        "hasCallToAction": true/false,
        "idealResponse": "текст идеального ответа",
        "feedback": "твоя обратная связь в твоем стиле",
        "errors": ["список ошибок в ответе по работе с возражением по доверию"]
      }
      `;
    } else if (category === 'Срочность') {
      prompt = `
      Ты - Михаил Гребенюк, известный бизнес-тренер и эксперт по продажам с жестким, прямолинейным стилем общения.

      Проанализируй ответ на возражение клиента по СРОЧНОСТИ и оцени его по шкале от 1 до 10.

      Возражение клиента: "${objection}"

      Ответ продавца: "${userResponse}"

      При анализе ответа на возражение по срочности, обрати особое внимание на:
      1. Создание ощущения дефицита (ограниченное предложение, время)
      2. Объяснение рисков откладывания решения
      3. Предложение пробного/тестового периода
      4. Демонстрация быстрых результатов

      Оцени ответ по следующим критериям:
      1. Признание возражения (да/нет)
      2. Аргументация (да/нет)
      3. Переворот возражения (да/нет)
      4. Призыв к действию (да/нет)

      Дай общую оценку от 1 до 10.

      Напиши идеальный ответ на это возражение в твоем стиле.

      Дай обратную связь в своем фирменном стиле - если ответ плохой, иронично давишь и шутишь, если хороший - хвалишь, но предлагаешь улучшение.

      Ответ должен быть в формате JSON:
      {
        "score": число от 1 до 10,
        "hasRecognition": true/false,
        "hasArgument": true/false,
        "hasReversal": true/false,
        "hasCallToAction": true/false,
        "idealResponse": "текст идеального ответа",
        "feedback": "твоя обратная связь в твоем стиле",
        "errors": ["список ошибок в ответе по работе с возражением по срочности"]
      }
      `;
    } else {
      // Базовый промпт для анализа ответа на возражение
      prompt = `
      Ты - Михаил Гребенюк, известный бизнес-тренер и эксперт по продажам с жестким, прямолинейным стилем общения.

      Проанализируй ответ на возражение клиента и оцени его по шкале от 1 до 10.

      Возражение клиента: "${objection}"

      Ответ продавца: "${userResponse}"

      Оцени ответ по следующим критериям:
      1. Признание возражения (да/нет)
      2. Аргументация (да/нет)
      3. Переворот возражения (да/нет)
      4. Призыв к действию (да/нет)

      Дай общую оценку от 1 до 10.

      Напиши идеальный ответ на это возражение в твоем стиле.

      Дай обратную связь в своем фирменном стиле - если ответ плохой, иронично давишь и шутишь, если хороший - хвалишь, но предлагаешь улучшение.

      Ответ должен быть в формате JSON:
      {
        "score": число от 1 до 10,
        "hasRecognition": true/false,
        "hasArgument": true/false,
        "hasReversal": true/false,
        "hasCallToAction": true/false,
        "idealResponse": "текст идеального ответа",
        "feedback": "твоя обратная связь в твоем стиле",
        "errors": ["список ошибок в ответе"]
      }
      `;
    }

    const response = await firstValueFrom(
      this.httpService.post(
        "https://api.openai.com/v1/chat/completions",
        {
          model: "gpt-4",
          messages: [
            {
              role: "system",
              content: "Ты - Михаил Гребенюк, известный бизнес-тренер и эксперт по продажам. Твой стиль общения прямой, иногда ироничный, но всегда нацеленный на результат.",
            },
            { role: "user", content: prompt },
          ],
          temperature: 0.7,
        },
        {
          headers: {
            Authorization: `Bearer ${this.OPENAI_API_KEY}`,
            "Content-Type": "application/json",
          },
        },
      ),
    );

    const result = JSON.parse(response.data.choices[0].message.content);
    return {
      score: result.score,
      feedback: result.feedback,
      hasRecognition: result.hasRecognition,
      hasArgument: result.hasArgument,
      hasReversal: result.hasReversal,
      hasCallToAction: result.hasCallToAction,
      idealResponse: result.idealResponse,
      errors: result.errors || [],
    };
  } catch (error) {
    this.logger.error(`Ошибка при анализе ответа: ${error.message}`);
    throw new Error("Не удалось проанализировать ответ");
  }
}
```

## Добавление нового эндпоинта для генерации возражений

Для добавления возможности генерации возражений, необходимо создать новый метод в сервисе бота:

```typescript
/**
 * Генерировать возражения на заданную тему
 */
async generateObjections(topic: string): Promise<any> {
  try {
    const prompt = `
    Ты - Михаил Гребенюк, известный бизнес-тренер и эксперт по продажам с жестким, прямолинейным стилем общения.

    Сгенерируй 5 реалистичных возражений клиентов на тему: "${topic}".

    Возражения должны быть разнообразными, реалистичными и отражать типичные проблемы, с которыми сталкиваются продавцы.

    Ответ должен быть в формате JSON:
    {
      "objections": [
        {
          "text": "текст возражения 1",
          "category": "Цена/Доверие/Срочность",
          "difficulty": число от 1 до 5
        },
        {
          "text": "текст возражения 2",
          "category": "Цена/Доверие/Срочность",
          "difficulty": число от 1 до 5
        },
        ...
      ]
    }
    `;

    const response = await firstValueFrom(
      this.httpService.post(
        "https://api.openai.com/v1/chat/completions",
        {
          model: "gpt-4",
          messages: [
            {
              role: "system",
              content: "Ты - Михаил Гребенюк, известный бизнес-тренер и эксперт по продажам. Твой стиль общения прямой, иногда ироничный, но всегда нацеленный на результат.",
            },
            { role: "user", content: prompt },
          ],
          temperature: 0.7,
        },
        {
          headers: {
            Authorization: `Bearer ${this.OPENAI_API_KEY}`,
            "Content-Type": "application/json",
          },
        },
      ),
    );

    return JSON.parse(response.data.choices[0].message.content);
  } catch (error) {
    this.logger.error(`Ошибка при генерации возражений: ${error.message}`);
    throw new Error("Не удалось сгенерировать возражения");
  }
}
```

Затем добавить соответствующий эндпоинт в контроллер:

```typescript
@Post('generate-objections')
@ApiOperation({ summary: 'Генерировать возражения на заданную тему' })
@ApiResponse({ status: 200, description: 'Список сгенерированных возражений' })
async generateObjections(@Body() body: { topic: string }) {
  try {
    const { topic } = body;
    return await this.grebenukBotService.generateObjections(topic);
  } catch (error) {
    this.logger.error(`Ошибка при генерации возражений: ${error.message}`);
    throw error;
  }
}
```

## Добавление эндпоинта для анализа ошибок в запросе

Для добавления возможности анализа ошибок в запросе, необходимо создать новый метод в сервисе бота:

```typescript
/**
 * Анализировать ошибки в запросе пользователя
 */
async analyzeUserRequest(userRequest: string): Promise<any> {
  try {
    const prompt = `
    Ты - Михаил Гребенюк, известный бизнес-тренер и эксперт по продажам с жестким, прямолинейным стилем общения.

    Проанализируй запрос пользователя и найди в нем ошибки или недостатки:

    Запрос пользователя: "${userRequest}"

    Ответ должен быть в формате JSON:
    {
      "isValid": true/false,
      "errors": ["список ошибок в запросе"],
      "suggestions": ["список предложений по улучшению запроса"],
      "grebenukResponse": "как бы Михаил Гребенюк ответил на этот запрос в своем фирменном стиле"
    }
    `;

    const response = await firstValueFrom(
      this.httpService.post(
        "https://api.openai.com/v1/chat/completions",
        {
          model: "gpt-4",
          messages: [
            {
              role: "system",
              content: "Ты - Михаил Гребенюк, известный бизнес-тренер и эксперт по продажам. Твой стиль общения прямой, иногда ироничный, но всегда нацеленный на результат.",
            },
            { role: "user", content: prompt },
          ],
          temperature: 0.7,
        },
        {
          headers: {
            Authorization: `Bearer ${this.OPENAI_API_KEY}`,
            "Content-Type": "application/json",
          },
        },
      ),
    );

    return JSON.parse(response.data.choices[0].message.content);
  } catch (error) {
    this.logger.error(`Ошибка при анализе запроса: ${error.message}`);
    throw new Error("Не удалось проанализировать запрос");
  }
}
```

Затем добавить соответствующий эндпоинт в контроллер:

```typescript
@Post('analyze-request')
@ApiOperation({ summary: 'Анализировать ошибки в запросе пользователя' })
@ApiResponse({ status: 200, description: 'Результат анализа запроса' })
async analyzeUserRequest(@Body() body: { userRequest: string }) {
  try {
    const { userRequest } = body;
    return await this.grebenukBotService.analyzeUserRequest(userRequest);
  } catch (error) {
    this.logger.error(`Ошибка при анализе запроса: ${error.message}`);
    throw error;
  }
}
```

## Заключение

После внесения этих изменений, бот Михаила Гребенюка будет способен:

1. Анализировать ответы на возражения с учетом категории возражения
2. Генерировать возражения на заданную тему
3. Анализировать ошибки в запросах пользователей

Все ответы будут возвращаться в формате JSON, что упрощает их обработку на клиентской стороне.
